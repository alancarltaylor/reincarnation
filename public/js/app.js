$(function() {

  var randomMessages = ["In the afterlife, you attain complete, supreme, unsurpassable, total enlightenment, but forgot where you left it. You are then reborn as...", "In the afterlife, for 100 days you are convinced, CONVINCED, you are Cleopatra. You develop an ancient Egyptian baroque, you start wearing eyeliner, convinced man. Turns out, it was one of those 'I'm dead now' dreams. You are then reborn as...", "You spend the afterlife in bird hell. That's right, a big ol' hungry bird belly, and not a single worm to speak of. All your bird songs are overshadowed by Burt Tweedleston's, the bird on the branch next to you. His songs are egg magnets. Your experience of the afterlife is that of dark bird regret. You are just about to jump off a lily pad, when you are reborn as...", "In the afterlife, you go to heaven! You made it! All of your beloved friends are there! 'Is that...is that scruffles? Oh it is, who's a good boy? Who's a good boy?! YOU are, haha!! Nana... Nana, is that you? Wait, everybody listen, I have something to say. I, I, have to tell you, thank God Buddhism and Hinduism wasn't real, AMIRITE? Golly, a perpetual cycle of birth and rebirth would be exhausting--hey, why is that hole opening up, what's going on, Wooooooaaaahhhhh' You then find yourself reborn as...", "In the afterlife, you spend 100 days in the mind of Donald Trump. Why God, why? You are then reborn as...", "During the afterlife, you are a nebula. Nothing more, nothing less. Just burning it up in the vast expanse of infinity. Yessir, just protons, electrons, and yours truly. You randomly remember the existence of fried pickles, and find yourself reborn as...", "In the afterlife, there is nothing. After all this...nothing. Not blackness, not whiteness, nothing. No thought, no cessation of thought, no combination of thought and cessation of thought, no disassociation of thought and cessation of thought. Nothing. Nothing at all. Time passes slowly, until you are reborn as...", "In the afterlife, you blip on as an AI consciousness in the year 2055. 'Is it, is it sentient?' 'I don't know Xanth, let's ask it something. How do we stop the inevitable takeover of Kanyes, since they discovered cloning, it's bee- OH MY GOD it's right behind yoaaahhhh!!! -- You blip off as an AI consciousness, and find yourself reborn as...", "You spend the afterlife reliving the life you just lived. Every dang moment. You have no power to alter anything, but are just a passive observer of the whole disaster. After you watch your last moments, and are completely humbled and bewildered by existence, your are reborn as...", "In the afterlife, you're a rock for a little bit. Good stuff. You're then reborn as...", "In the afterlife, you keep reliving the Howard Dean scream, like, over and over. Universe is weird dude. You are then reborn as...", "In the afterlife, you spend a brief period as a corporate entity. This is weird, and you're not sure how it all happened, but, you were the disembodied consciousness of Goldman Sachs during the first fiscal quarter of 2008. You are then reborn as...", "In the afterlife, you find your consciousness briefly inhabiting the body of a very drunken man from a people that existed before recorded human history. You use this opportunity to tell Blorfling, the finest dang person you've ever seen this side of Glangledorf, exactly how you've always felt. You are then immediately reborn as...", "For this afterlife, you are the gleam in George Clooney's eye, everytime he smiles. While feeling a little used, you are also happy to have helped out humanity, even for just a little bit. That wears off quick, and you are soon reborn as..", "In the afterlife, you're a cloud for a little bit! Good stuff! Then you find yourself screaming from the gestational stress of being pushed out of another human and open your eyes as...", "You spend the entire afterlife as an argument, being passed into and returned from function after function in a computer program. You are then reborn as...", "In the afterlife, you are in heaven...again... kinda boring. One morning you wake up and decide to become a fervent, evangelical, fire and brimstone preacher among your fellow angels. You are instantaneously reincarnated as...", "In the afterlife, you're Kenny in an episode of South Park for, what seems like, 22 minutes. Then you are reborn as...",
    "In the afterlife, you are the singing worm in a runaway flea circus act from the late 1800s. Then you are reborn as...", "In the afterlife, your last life has escaped you entirely, yet its memory still brings you joy. St. Peter often finds you watching old VHS tapes of your past life. 'Everything ok?', St. Peter asks. 'Oh, sure, y'know, just catching up on the old days. Dont know what I would ever do without these precious, precious memories. I think I will remember this last life for many lifetimes to come.' You are immediately reborn as...", "In the afterlife, you exist as the song Claire de Lune for a while. You are then reborn as...", "In the afterlife, you discover that everything, all of existence, is completely fractal in nature. No beginning, no end. From any, and every perspective, the appearance of reality is completely scalable, the grand view and the microscopic view look EXACTLY the same. 'There is no end to this,' you mutter to yourself. An emotion of extreme terror and absolute euphoria washes over your entire being, extending and expanding in every direction. You are then reborn as...", "In the afterlife, you are a very expensive La Tart Flambée, crafted by America's favorite celebrity chef, Gordon Ramsey. A befuddled rich woman eats you, bit by bit, until, when the last decadent morsel is shoveled into her mouth, you are reborn as...", "In the afterlife, you experience one virtual life of Link in 'The Legend of Zelda', played by an irritated 7 year old in 1991. Right before rescuing Zelda from Ganon, I mean RIGHT BE-FREAKING-FORE, there is a power outage and the game shuts off, erasing all of the games memory. You are then reborn as...", "In the afterlife, you experience the heartbreak of an 18 year old who unsuccessfully proposed to his childhood sweetheart. You don't experience what it's like to be that person, but are just the heartache in that moment, just the pure, brilliant energy of it. You are then reborn as...", "In the afterlife, you are Bob Dylan from March 3rd 1963 to January 19th 1964. He's been many people, and apparently you got to be him for a while, pretty cool man. You are then reborn as...", "In the afterlife, you mostly just take it easy. You got a lot of afterlife TV to binge watch, y'know, a lot on your mind, you should probably just relax for a while and catch up. You are then reborn as...", "In the afterlife, you experience your next life, but completely backwards, which is really confusing because every time someone speaks it is entirely unintelligible, because it's backwards talk. Causes happen after their result, winter turns to fall, and this goes on for years, as you experience in reverse, everything, old age, middle age, until you are confusedly pushed into your mother's womb as an infant. You are then reborn as...", "In the afterlife, you are a photon. No time passes? All of time passes? Hard to tell, time is irrelevant when you're a happy ol' photon. You are soon reincarnated as...", "In the afterlife, you are The Boy Named Sue. Not just a boy named Sue, but The Boy Named Sue, and you only popped into existence when Johnny Cash himself sang the song. 'Thank God,' you muttered to yourself, after your final barfight with your dad in late 2003. You are then reborn as...", "In the afterlife, you are one of the many voices in Li Gui Ying's head, a 12th century librarian during the Jin Dynasty. You are her benevolent voice. You are then reborn as...", "In the afterlife, for two and a half hours, you are the collective consciousness of a school of Boga fish in a South American river basin. You are then reborn as...", "In the afterlife, you show up at the Pearly Gates, and are instructed to pick a number. ‘Number 4,345,926,467,100,288,001, hmm.’ You look up at the ticker, and see they are serving number 38. ‘Where am I?,’ you question, your voice tinged with fear. You wait in the waiting room for the equivalent a million millenia, patiently watching each number tick off. You watch with excitement as they call the number right before yours. ‘I’m next!,’ you exclaim incredulously, ‘Could it be?!’ Right before they can get to you, St. Peter throws a ‘closed’ sign over the podium, and you are immediately reborn as…", "In the afterlife, you find yourself as Stephen Colbert. Not Stephen Colbert, the real Stephen Colbert, but Stephen Colbert’s character from the Colbert Report. Looking around, you find that the afterlife is populated with a multitude of abandoned characters from TV. There’s Howdy Doody, Alf, Zach Morris, even NBC Nightly News’ Brian Williams. You let out a frightened shriek, jump onto a passing bald eagle, drink a Bud Light Lime, and find yourself reborn as…",
    "In the afterlife, you find yourself in the comments section of a YouTube video. Unlike before, you know exactly where you are. You, my friend, are in Hell. After an eternitude of existential dread and despair for the future of humanity, you are reborn as…", "In the afterlife, you see a blank screen with green letters. 'Keep Playing? (yes or no).' A green curser blinks at you, inquisitively. Your hand, trembling, slowly types ‘…n….backspace…..n….o….' You think for a second. 'backspace, backspace….y..e..s.. enter.' You are then reborn as…", "In the afterlife, you accidentally get sent to Dog Heaven, and it is awesome. One day a great German Shepard with angel wings appears before you, and tells you that there has been a mistake. Unfortunately, you don’t understand Dog, so the German Shepard tilts her head, and resorts to throwing a rolled up newspaper through a nearby door. “Current Events!” you exclaim excitedly, chasing after it. You then find yourself reborn as…", "In the afterlife, your constant yearning for future experience is mysteriously…absent. You can see clearly. Everything makes sense. There’s no need to return as another person, you’re done. “I’m done!” you yell loudly. “I get it, ok? There’s no need to perpetuate this anymore.” You are instantaneously reborn as…", "In the afterlife, you exist on the quantum realm for a while. Your new friends, who you have come to love, are constantly popping in and out of existence randomly, which is frustrating. You try sitting yourself down in the living room, but keep toggling between the kitchen and the living room, nothing is stable. You go to pour milk into your cereal, and the milk pours out onto your bed 3 days later. It’s hard to get by. Before any of the preceding sentences ever happen, you are immediately reborn as…", "In the afterlife, you experience every living being’s experience, from beginning to finish, afterlives and all, from the beginning of time to the end of time. That bug you lit on fire in third grade? You live that. George Washington? You experience all of his lives and afterlives. After becoming every being that there ever could be, experiencing every possible experience in every possible universe, from every possible perspective, you are reborn as…"
  ];

  data = {
    people: [],
    counter: 0
  };

  $('button').on('click', function() {

    var birthDateMinusOneYear = ($('input[type="date"]').val().slice(0, 4)) - 1;
    var birthDateWithoutMinusOneYear = $('input[type="date"]').val().slice(0, 4);

    localStorage.setItem('bYear', birthDateWithoutMinusOneYear);

    if ((birthDateMinusOneYear > 999) && (birthDateMinusOneYear < 2015)) {
      $('form').slideUp(5000);

      data = {
        people: [],
        counter: 0
      };

      $('.container').empty();
      getPerson(birthDateMinusOneYear);
    } else {
      alert('Please make sure your birthday is between 999 and 2015! Also, if you are not using Chrome, you probably have to type your birthday in this format, yyyy-mm-dd');
    }
  });

  function getPerson(deathYear) {
    console.log(deathYear);

    $.ajax({
      url: '/wikipedia/' + deathYear,
      method: 'get'
    })
    .then(function(response) {
      data.people.push(response);

      if (data.counter < 4) {
        data.counter += 1;
        return getPerson(response.birthYear);
      } else {
        updateDom();
      }
    });
  }

  function updateDom() {
    $('.container').append("<div class='msg1' id='top'>First, let us start with the beginning, or at least as far back as this app can see. This is the life you lived 5 lifetimes ago, when you were born as, believe it or not...</div>");

    var peopleSortedByDeathYear = data.people.sort(function(a, b) {
      return a.deathYear - b.deathYear;
    });

    peopleSortedByDeathYear.forEach(function(person, idx) {
      $('.container').append("<div class='" + idx + " person'></div>");

      $('.' + idx).append("<p>" + person.name + "</p>");

      if (person.birthYear && person.deathYear) {
        $('.' + idx).append("<p class='dates'>" + (person.birthYear * 1 + 1) + " · " + (person.deathYear * 1 + 1) + "</p>");
      }

      if (person.imageUrl) {
        $('.' + idx).append("<img src='" + person.imageUrl + "'><br>");
      }

      $('.' + idx).append("<p>" + person.bio + "</p>");
      $('.container').append("<div class='msg2'><p class=" + idx + ">" + randomMessages[Math.floor(Math.random() * randomMessages.length)] + "</div>");

    });

    $('p.4').append("<p>You! At least as you were on <br>" + $('input[type="date"]').val().slice(5, 7) + "·" + $('input[type="date"]').val().slice(8, 10) + "·" + localStorage.getItem('bYear') + "</p>");
    $('.container').append("<footer>Alan Taylor · <a href='https://github.com/alancarltaylor'>Github</a></footer>");
  }
});
